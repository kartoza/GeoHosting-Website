{% extends "templates/web.html" %}

{% block navbar %}
    {% include "templates/customer_portal_nav.html" %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Set a New Password</h1>
    </div>
    <form id="update-password-form">
        <input type="hidden" name="reset_key" value="{{ frappe.form_dict.key }}">
        <div class="form-group">
            <label for="new-password">New Password</label>
            <input type="password" class="form-control" id="new-password" name="new_password" required>
        </div>
        <div class="form-group">
            <label for="confirm-password">Confirm Password</label>
            <input type="password" class="form-control" id="confirm-password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary">Confirm</button>
    </form>
</div>

<script>
    document.getElementById('update-password-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        const resetKey = formData.get('reset_key');
        const newPassword = formData.get('new_password');
        const confirmPassword = formData.get('confirm_password');

        if (newPassword !== confirmPassword) {
            alert('Passwords do not match!');
            return;
        }

        frappe.call({
            method: 'frappe.core.doctype.user.user.update_password',
            args: {
                key: resetKey,
                new_password: newPassword
            },
            callback: function(response) {
                if (response.message === 'Password Updated') {
                    alert('Password has been updated successfully.');
                    window.location.href = '/login';  // Redirect to login page after password update
                } else {
                    alert('Failed to update password.');
                }
            }
        });
    });
</script>
{% endblock %}